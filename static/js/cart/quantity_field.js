const initial_quantity_fields_values={},header_cart_badge=document.querySelector("header ion-icon[name='cart']").nextElementSibling,unit_prices={};function blur_quantity_field_if_it_is_enter_key(t){let e=t.target;"Enter"===t.key&&(t.preventDefault(),e.blur())}function update_cart_product(t){let e=t.target,n=+e.value,i=initial_quantity_fields_values[e.id];if(console.log(n),n==i)return;if(isNaN(n)||n<1){e.value=i,alert("Minimum quantity is 1!");return}if(n>10){e.value=i,alert("Maximum quantity is 10!");return}send_post_request_to_update_cart_product(n,+e.attributes["data-product_id"].nodeValue),update_header_cart_badge_count(i,n);let a=e.id.split("_"),r=parseInt(a[a.length-1]);update_total_price_of_product(n,i,r),initial_quantity_fields_values[e.id]=n}function send_post_request_to_update_cart_product(t,e){fetch("/cart/update/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRFToken":csrf_token},body:JSON.stringify({quantity:t,product_id:e})}).then(t=>t.text()).then(t=>alert(t)).catch(t=>{console.log(t),alert("There was an error! Try again later.")})}function update_header_cart_badge_count(t,e){header_cart_badge.textContent=+header_cart_badge.textContent-t+e}function update_total_price_of_product(t,e,n){let i=document.querySelector(`#total_price_${n}`),a=parseFloat(i.textContent),r=unit_prices[`unit_price_${n}`],u=r*e,o=r*t;i.textContent=a-u+o,i.textContent+=".0$",update_total_price(u,o)}function update_total_price(t,e){let n=document.querySelector("#total_price"),i=parseFloat(n.textContent);n.textContent=i-t+e,n.textContent+=".0$"}document.querySelectorAll(".unit_price").forEach(t=>unit_prices[t.id]=parseFloat(t.textContent)),document.querySelectorAll("input[name='quantity']").forEach(t=>{initial_quantity_fields_values[t.id]=+t.value,t.addEventListener("keydown",blur_quantity_field_if_it_is_enter_key),t.addEventListener("blur",update_cart_product)});